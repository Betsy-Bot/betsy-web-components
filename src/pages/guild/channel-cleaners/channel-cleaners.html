<template>
    <feature-header
        doc-url="https://docs.betsybot.xyz/features/channel-cleaners"
        title="Discord Channel Cleaners"
        subtitle="Channel cleaners are an easy way to keep your channel history clean. Channel cleaners are run on every server at the top of the hour and will remove all messages older than your specified time in hours."
    ></feature-header>

    <div class="container-fluid mt-2">
        <div class="row g-5">
            <div class="col-12 col-lg-6 col-xl-4">
                <form submit.trigger="addChannelCleaner()" mdc-elevation="10" class="p-4">
                    <h5>Create New Cleaner</h5>
                    <discord-channel-selector
                        required.bind="true"
                        label="Select Channel or Category"
                        channel-id.two-way="request.discordChannelId"
                    ></discord-channel-selector>
                    <moo-text-field
                        required
                        type="number"
                        max="322"
                        min="1"
                        class="w-100 mt-2"
                        label="Max age (in hours) allowed"
                        placeholder="Enter time in hours"
                        value.bind="request.ageInHours"
                    ></moo-text-field>
                    <div class="text-end">
                        <moo-button class="mt-2" type="submit" variant="primary">
                            Add
                        </moo-button>
                    </div>
                </form>
            </div>
            <div class="col-12 col-lg-6 col-xl-4" repeat.for="cleaner of cleaners">
                <div mdc-elevation="10" class="p-4 h-100">
                    <h5>Cleaner in #${getChannelName(cleaner.discordChannelId)}</h5>
                    <div>
                        Messages older than ${cleaner.ageInHours} hours old are deleted hourly at the top of the hour.
                    </div>
                    <form submit.trigger="updateCleaner(cleaner)">
                        <moo-text-field
                            required
                            type="number"
                            max="322"
                            min="1"
                            class="w-100 mt-2 mb-2"
                            label="Max age (in hours) allowed"
                            placeholder="Enter time in hours"
                            value.bind="cleaner.ageInHours"
                        ></moo-text-field>
                        <div class="row mt-4">
                            <div class="col">
                                <moo-button variant="secondary" type="button" click.trigger="deleteChannelCleaner(cleaner.id)">
                                    Delete
                                </moo-button>
                            </div>
                            <div class="col text-center">
                                <moo-button variant="secondary" type="button" click.trigger="manuallyClean(cleaner.id)">
                                    TEST
                                </moo-button>
                            </div>
                            <div class="col text-end">
                                <moo-button variant="primary" type="submit">
                                    Update
                                </moo-button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</template>
