<template>
    <section id="edit-data-command">
        <div class="row">
            <div class="col-8">
                <feature-header
                    doc-url="https://docs.betsybot.xyz/configurable-commands/data-commands"
                    title="${isNew ? 'Create' : 'Edit'} Data Command"
                    subtitle="Data commands are commands that gather information and relay that information to this admin panel or your own API integration. This can be captured in a form, a message embed, or just through command parameters."
                ></feature-header>

                <div>
                    <div class="mt-1 mb-3 text-warning fs-7 d-inline-flex align-content-center">
                        <span class="material-icons me-2">
                            warning
                        </span>
                        Only form data commands are currently available
                    </div>
                </div>

                <form submit.trigger="save()" if.bind="command">
                    <div class="mt-4">
                        <discord-command-creator command.two-way="command"></discord-command-creator>
                    </div>

                    <moo-tab-bar>
                        <moo-tab
                            label="Form Command"
                            tab.bind="tab"
                            value="form"
                            active.bind="tab === 'form'"
                        ></moo-tab>
                        <moo-tab
                            label="REST Request Command"
                            active.bind="tab === 'rest'"
                            value="rest"
                            tab.bind="tab"
                        ></moo-tab>
                    </moo-tab-bar>

                    <template if.bind="tab === 'form'">
                        <div class="my-2 fs-6 fw-bolder">
                            Form commands will open a created form once executed
                        </div>
                        <discord-form-selector
                            label="Select form to open"
                            form-id.two-way="command.discordCommandActions[0].discordFormId"
                        ></discord-form-selector>
                    </template>

                    <template if.bind="tab === 'rest'">
                        <div class="my-2 fs-6 fw-bolder">
                            REST Requests commands send a POST/PUT/PATCH to your entered API.
                        </div>
                        <moo-text-field
                            class="w-100"
                            label="API Url"
                            value.bind="command.discordCommandActions[0].restRequestMetadata.apiUrl"
                            placeholder="https://example.com/api/someEndpoint"
                            required.bind="true"
                        ></moo-text-field>
                        <mdc-form-field repeat.for="type of restTypes">
                            <mdc-radio model.bind="type"
                                       checked.bind="command.discordCommandActions[0].type"></mdc-radio>
                            <label>${getDisplayTextForCommandActionType(type)}</label>
                        </mdc-form-field>
                        <div class="my-2" style="min-height: 45px;">
                            <moo-button variant="primary" click.bind="() => addHeader()" type="button">
                                Add Header
                            </moo-button>
                            <div class="row g-4">
                                <div class="col-12 col-md-6"
                                     repeat.for="header of command.discordCommandActions[0].restRequestMetadata.requestHeaders">
                                    <div elevation="9" class="p-2">
                                        <div class="text-end">
                                            <span class="cursor-pointer" click.trigger="removeHeader($index)">X</span>
                                        </div>
                                        <moo-text-field
                                            class="w-100"
                                            label="Header Name"
                                            value.bind="header.name"
                                            placeholder="Authorization"
                                            required.bind="true"
                                        ></moo-text-field>
                                        <moo-text-field
                                            class="w-100"
                                            label="Header Value"
                                            value.bind="header.value"
                                            placeholder="Bearer 123.abc.xyz"
                                            required.bind="true"
                                        ></moo-text-field>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="my-2" style="min-height: 45px;">
                            <div class="my-2 fs-6 fw-bolder">
                                Parameters can be mapped using dot notation.
                            </div>
                            <span>someObject.someProperty will end up with JSON that looks like
                                <br> { "someObject": { "someProperty": "" } }
                                <br> This can be as deep as you'd like.
                                <br> <span class="fw-bolder">Reach out in Discord if you need assistance</span>
                            </span>
                            <div class="my-2">
                                <moo-button variant="primary" click.bind="() => addParameter()" type="button">
                                    Add Parameter
                                </moo-button>
                            </div>
                            <div class="row g-4">
                                <div class="col-12 col-md-6"
                                     repeat.for="parameter of command.commandInformation.options">
                                    <div elevation="9" class="p-2">
                                        <div class="text-end">
                                            <span class="cursor-pointer"
                                                  click.trigger="removeParameter($index)">X</span>
                                        </div>
                                        <discord-command-parameter-creator
                                            parameter.two-way="parameter"></discord-command-parameter-creator>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="my-2">
                            <div class="my-2 fs-6 fw-bolder">
                                Default Data
                            </div>
                            <span>
                                This also uses dot notation and will fill in any data you need for your API
                                <br>Which are not required to be entered in with the command
                            </span>
                            <div class="my-2" style="min-height: 50px;">
                                <moo-button variant="primary" click.bind="() => addDefaultData()"
                                        type="button">
                                    Add Default Data
                                </moo-button>
                            </div>
                            <div class="row g-4">
                                <div class="col-12 col-md-6"
                                     repeat.for="parameter of command.discordCommandActions[0].restRequestMetadata.defaultRequestData">
                                    <div elevation="9" class="p-2">
                                        <div class="text-end">
                                            <span class="cursor-pointer"
                                                  click.trigger="removeDefaultData($index)">X</span>
                                        </div>
                                        <discord-command-parameter-creator
                                            parameter.two-way="parameter"
                                            hide-description.bind="true"
                                            hide-switch.bind="true"
                                            show-value.bind="true"
                                        ></discord-command-parameter-creator>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="my-2">
                            <div class="my-2 fs-6 fw-bolder">
                                Response Mapping
                            </div>
                            <span>
                                This is optional. If you leave this alone you will receive the entire JSON response in the message.
                                <br> If you add response mapping parameters ONLY those included in these mappings will be shown.
                                <br> This also uses dot notation and will fill in any data you need for your API
                            </span>
                            <div class="my-2" style="min-height: 50px;">
                                <moo-button variant="primary" click.bind="() => addResponseMapping()"
                                        type="button">
                                    Add Response Mapping
                                </moo-button>
                            </div>
                            <div class="row g-4">
                                <div class="col-12 col-md-6"
                                     repeat.for="parameter of command.discordCommandActions[0].restRequestMetadata.requestResponseMappings">
                                    <div elevation="9" class="p-2">
                                        <div class="text-end">
                                            <span class="cursor-pointer"
                                                  click.trigger="removeResponseMapping($index)">X</span>
                                        </div>
                                        <discord-command-parameter-creator
                                            parameter.two-way="parameter"
                                            hide-description.bind="true"
                                            hide-switch.bind="true"
                                        ></discord-command-parameter-creator>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </template>


                    <div elevation="12" class="mt-4 p-3">
                        <div>
                            Command Response Message
                        </div>
                        <discord-action-creator
                            single.bind="true"
                            action.bind="command.discordCommandActions[0]"
                            forced-type.bind="true"
                        ></discord-action-creator>

                        <div class="mt-5">
                            <div class="text-end mt-3">
                                <moo-button variant="primary" type="submit" class="button-primary">
                                    Save
                                </moo-button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="col-4">
                <discord-message-preview
                    message.two-way="command.discordCommandActions[0].discordMessage.message"></discord-message-preview>
            </div>
        </div>
    </section>
</template>
