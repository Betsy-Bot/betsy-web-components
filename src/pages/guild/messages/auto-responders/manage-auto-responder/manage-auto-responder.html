<template>
    <section id="create-data-command">
        <div class="row">
            <div class="col-12 col-lg-8">
                <feature-header
                    doc-url="https://docs.betsybot.xyz/features/auto-responders"
                    title="${isNew ? 'Create' : 'Edit'} Auto Responders"
                    subtitle="Respond to commonly asked questions, comments, and more."
                ></feature-header>

                <moo-tab-bar>
                    <moo-tab
                        label="Settings"
                        tab.bind="tab"
                        value="settings"
                        active.bind="tab === 'settings'"
                    ></moo-tab>
                    <moo-tab
                        label="Message"
                        active.bind="tab === 'message'"
                        value="message"
                        tab.bind="tab"
                    ></moo-tab>
                </moo-tab-bar>

                <form submit.trigger="save()">
                    <div class="col-12 my-3">
                        <moo-switch
                            value.bind="responder.active"
                        ></moo-switch>
                        <label class="me-5">Active?</label>
                    </div>
                    <div if.bind="tab === 'settings'">
                        <moo-text-field
                            label="Identifier"
                            type="text"
                            class="w-100"
                            value.bind="responder.name"
                        ></moo-text-field>
                        <div class="row">
                            <div class="col-12">
                                <mdc-form-field repeat.for="type of types">
                                    <div></div>
                                    <mdc-radio model.bind="type.value" checked.bind="responder.type"></mdc-radio>
                                    <label>${type.label}</label>
                                </mdc-form-field>
                            </div>
                            <div class="col-12">
                                    <div class="row my-3">
                                        <div class="col-10">
                                            <moo-text-field
                                                label="Words / Phrases"
                                                type="text"
                                                class="w-100"
                                                value.bind="phrase"
                                            ></moo-text-field>
                                        </div>
                                        <div class="col-2">
                                            <moo-button variant="primary" class="button-primary w-100 h-100" type="button" click.trigger="addPhrase()">
                                                Add
                                            </moo-button>
                                        </div>
                                    </div>
                                <div repeat.for="phrase of responder.phrases">
                                    ${phrase.value}
                                    <span class="text-danger me-2 cursor-pointer" click.trigger="removePhrase($index)">
                                        ( X )
                                    </span>
                                </div>
                            </div>
                        </div>
                        <moo-text-field
                            label="Delete After (Minutes)"
                            type="number"
                            min="0"
                            max="600"
                            class="w-100 my-3"
                            value.bind="responder.deleteAfterMinutes"
                        ></moo-text-field>
                        <discord-channel-selector
                            label="Add Ignored Channels"
                            type.bind="0"
                            channel-id.two-way="selectedIgnoreChannelId"
                        ></discord-channel-selector>
                        <div class="mb-3">
                            <div repeat.for="channelId of responder.ignoredChannels">
                                ${channelId}
                                <span class="text-danger me-2 cursor-pointer" click.trigger="removeIgnoredChannel($index)">
                                    ( X )
                                </span>
                            </div>
                        </div>
                        <discord-channel-selector
                            label="Add Whitelisted Channels"
                            type.bind="0"
                            channel-id.two-way="selectedWhitelistChannelId"
                        ></discord-channel-selector>
                        <div repeat.for="channelId of responder.whitelistedChannels">
                            ${channelId}
                            <span class="text-danger me-2 cursor-pointer" click.trigger="removeWhitelistedChannel($index)">
                                ( X )
                            </span>
                        </div>
                        <discord-channel-selector
                            label="Add Whitelisted Categories"
                            type.bind="4"
                            channel-id.two-way="selectedWhitelistCategoryId"
                        ></discord-channel-selector>
                        <div repeat.for="categoryId of responder.whitelistedCategories">
                            ${categoryId}
                            <span class="text-danger me-2 cursor-pointer" click.trigger="removeWhitelistedCategory($index)">
                                ( X )
                            </span>
                        </div>
                        <div class="text-end">
                            <moo-button variant="primary" click.trigger="tab = 'message'" type="button">
                                Next
                            </moo-button>
                        </div>
                    </div>
                    <div class="" if.bind="tab === 'message'">
                        <discord-message-creator
                            allow-components.bind="true"
                            message.two-way="responder.discordMessage.message"
                        ></discord-message-creator>

                        <div class="text-end mt-3">
                            <moo-button variant="primary" type="submit">
                                Save
                            </moo-button>
                        </div>
                    </div>
                </form>
            </div>
            <div class="col-12 col-lg-4">
                <discord-message-preview message.two-way="responder.discordMessage.message"></discord-message-preview>
            </div>
        </div>
    </section>
</template>
