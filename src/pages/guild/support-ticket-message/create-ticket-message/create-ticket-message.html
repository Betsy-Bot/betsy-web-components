<template>
    <section id="support-tickets">
        <div class="row">
            <div class="col-12 col-lg-8">
                <feature-header
                    doc-url="https://docs.betsybot.xyz/features/support-tickets"
                    title="Create Support Ticket Message"
                    subtitle="Create a support ticket tracking system. Create your message with the 'Create Ticket' component. Open tickets to your selected category. When tickets are closed the entire channel transcript is saved."
                ></feature-header>

                <moo-tab-bar>
                    <moo-tab
                        label="Settings"
                        tab.bind="tab"
                        value="settings"
                        active.bind="tab === 'settings'"
                    ></moo-tab>
                    <moo-tab
                        label="Panel Message"
                        active.bind="tab === 'container'"
                        value="container"
                        tab.bind="tab"
                    ></moo-tab>
                    <moo-tab
                        label="Initial Message"
                        active.bind="tab === 'initial'"
                        value="initial"
                        tab.bind="tab"
                    ></moo-tab>
                </moo-tab-bar>

                <div class="my-3"></div>

                <div if.bind="tab === 'settings'">
                    <form submit.trigger="tab = 'container'">
                        <support-ticket-settings
                            guild-id.bind="guildId"
                            request.two-way="request"
                            authorized-role.two-way="authorizedRole"
                        ></support-ticket-settings>

                        <div class="text-end">
                            <moo-button class="mt-2" disabled.bind="didLoad" type="submit">
                                Next
                            </moo-button>
                        </div>
                    </form>
                </div>

                <div if.bind="tab === 'container'">
                    <div class="fs-6 pb-3">Customize the Message Container which is to house the Create Ticket Button
                    </div>
                    <discord-message-creator
                        max-components.bind="1"
                        allow-components.bind="true"
                        message.bind="request.discordMessage.message"
                        single.bind="true"
                    ></discord-message-creator>

                    <div class="text-end">
                        <moo-button label="next" class="button-primary mt-2" type="button" disabled.bind="didLoad"
                                click.trigger="tab = 'initial'">
                            Next
                        </moo-button>
                    </div>
                </div>

                <div if.bind="tab === 'initial'">
                    <form submit.trigger="setupSupportTicket()" class="mt-3" if.bind="didBind">
                        <div class="fs-6 pb-3">Customize the Initial Message that is sent to the channel when the
                            support ticket channel is created
                        </div>
                        <moo-text-field
                            class="w-100"
                            label="Close Button Text"
                            maxlength="15"
                            value.bind="request.closeButtonText">
                        </moo-text-field>
                        <mdc-text-field-helper-line>
                            <mdc-text-field-character-counter></mdc-text-field-character-counter>
                        </mdc-text-field-helper-line>

                        <discord-message-creator
                            allow-components.bind="true"
                            message.two-way="request.initialMessage"
                            single.bind="true"
                        ></discord-message-creator>

                        <div class="text-end">
                            <moo-button class="button-primary mt-2" type="submit" disabled.bind="didLoad">
                                Setup Message
                            </moo-button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="col-12 col-lg-4">
                <discord-message-preview message.two-way="request.discordMessage.message"
                                         if.bind="tab === 'container'"></discord-message-preview>
                <discord-message-preview message.two-way="request.initialMessage"
                                         if.bind="tab === 'initial'"></discord-message-preview>
            </div>
        </div>
    </section>
</template>
