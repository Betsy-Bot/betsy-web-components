<template>
    <section id="support-tickets">
        <div class="row">
            <div class="col-12 col-lg-8">
                <discord-feature-header
                    title="Create Support Ticket Message"
                    subtitle="Create a support ticket tracking system. Create your message with the 'Create Ticket' component. Open tickets to your selected category. When tickets are closed the entire channel transcript is saved."
                ></discord-feature-header>

                    <mdc-tab-bar view-model.ref="tabBar">
                        <mdc-tab
                            label="Settings"
                            active.bind="tab === 'settings'"
                            click.delegate="tab = 'settings'"
                        ></mdc-tab>
                        <mdc-tab
                            label="Support Ticket Container"
                            active.bind="tab === 'container'"
                            click.delegate="tab = 'container'"
                        ></mdc-tab>
                        <mdc-tab
                            label="Ticket Created Message"
                            active.bind="tab === 'initial'"
                            click.delegate="tab = 'initial'"
                        ></mdc-tab>
                    </mdc-tab-bar>

                    <div class="my-3"></div>

                    <div if.bind="tab === 'settings'">
                        <form submit.delegate="tab = 'container'">
                            <support-ticket-settings
                                guild-id.bind="guildId"
                                request.two-way="request"
                                authorized-role.two-way="authorizedRole"
                            ></support-ticket-settings>

                            <div class="text-end">
                                <button mdc-button class="button-primary mt-2" disabled.bind="loading" type="submit">
                                    Next
                                </button>
                            </div>
                        </form>
                    </div>

                    <div if.bind="tab === 'container'">
                        <div class="fs-6 pb-3">Customize the Message Container which is to house the Create Ticket Button</div>
                        <discord-message-creator
                            max-components.bind="1"
                            allow-components.bind="true"
                            message.bind="request.discordMessage.message"
                            single.bind="true"
                        ></discord-message-creator>

                        <div class="text-end">
                            <button mdc-button class="button-primary mt-2" type="button" disabled.bind="loading" click.delegate="tab = 'initial'">
                                Next
                            </button>
                        </div>
                    </div>

                    <div if.bind="tab === 'initial'">
                        <form submit.delegate="setupSupportTicket()" class="mt-3" if.bind="bound">
                            <div class="fs-6 pb-3">Customize the Initial Message that is sent to the channel when the support ticket channel is created</div>
                            <mdc-text-field
                                class="w-100"
                                label="Close Button Text"
                                maxlength="15"
                                value.bind="request.closeButtonText">
                            </mdc-text-field>
                            <mdc-text-field-helper-line>
                                <mdc-text-field-character-counter></mdc-text-field-character-counter>
                            </mdc-text-field-helper-line>

                            <discord-message-creator
                                allow-components.bind="false"
                                message.two-way="request.initialMessage"
                                single.bind="true"
                            ></discord-message-creator>

                            <div class="text-end">
                                <button mdc-button class="button-primary mt-2" type="submit" disabled.bind="loading">
                                    Setup Message
                                </button>
                            </div>
                        </form>
                    </div>
            </div>
            <div class="col-12 col-lg-4">
                <discord-message-preview message.bind="request.discordMessage.message"></discord-message-preview>
            </div>
        </div>
    </section>
</template>
