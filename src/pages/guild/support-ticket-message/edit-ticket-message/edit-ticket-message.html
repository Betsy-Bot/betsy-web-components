<template>
    <confirmation-dialog
        cancel-text="Cancel"
        confirm-text="Delete"
        dialog.two-way="confirmDeleteDialog"
        handler.call="deleteSupportTicket(event)"
        title="Are you sure you would like to delete?"
    >
        This is a permanent action and cannot be undone
    </confirmation-dialog>

    <section id="support-tickets">
        <div class="row">
            <div class="col-12 col-lg-8">
                <discord-feature-header
                    title="Edit Support Ticket Message"
                    subtitle="Edit the message that is already on your server."
                ></discord-feature-header>

                <div class="row mt-3 mb-4">
                    <div class="col-4">
                        <a href="guild/${guildId}/support-tickets/${discordMessageId}/submissions" mdc-button class="button-primary">
                            View Created Tickets
                        </a>
                    </div>
                    <div class="col-4 text-center">
                        <button mdc-button class="button-primary" click.delegate="handleClone()">
                            Clone Support Ticket
                        </button>
                    </div>
                    <div class="col-4 text-end">
                        <button mdc-button class="button-secondary" click.delegate="confirmDeleteDialog.open()">
                            Delete Support Ticket
                        </button>
                    </div>
                </div>

                <mdc-tab-bar view-model.ref="tabBar">
                    <mdc-tab
                        label="Settings"
                        active.bind="tab === 'settings'"
                        click.delegate="tab = 'settings'"
                    ></mdc-tab>
                    <mdc-tab
                        label="Support Ticket Container"
                        active.bind="tab === 'container'"
                        click.delegate="tab = 'container'"
                    ></mdc-tab>
                    <mdc-tab
                        label="Ticket Created Message"
                        active.bind="tab === 'initial'"
                        click.delegate="tab = 'initial'"
                    ></mdc-tab>
                </mdc-tab-bar>

                <form submit.delegate="editSupportTicketSettings()">
                    <div if.bind="tab === 'settings'">
                        <div class="fs-6 py-3">Customize the Message Container which is to house the Create Ticket Button</div>
                        <support-ticket-settings
                            guild-id.bind="guildId"
                            request.two-way="ticket"
                            authorized-role.two-way="authorizedRole"
                        ></support-ticket-settings>
                    </div>

                    <div if.bind="tab === 'container'">
                        <discord-message-creator
                            max-components.bind="1"
                            allow-components.bind="true"
                            message.bind="ticket.discordMessage.message"
                            single.bind="true"
                        ></discord-message-creator>
                    </div>

                    <div if.bind="tab === 'initial'">
                        <div class="fs-6 py-3">Customize the Initial Message that is sent to the channel when the support ticket channel is created</div>
                        <discord-message-creator
                            allow-components.bind="false"
                            message.two-way="ticket.initialMessage"
                            single.bind="true"
                        ></discord-message-creator>
                    </div>

                    <button mdc-button class="button-primary mt-2" type="submit">
                        Save
                    </button>
                </form>
            </div>
            <div class="col-12 col-lg-4">
                <discord-message-preview message.bind="ticket.discordMessage.message" if.bind="tab === 'container'"></discord-message-preview>
                <discord-message-preview message.bind="ticket.initialMessage" if.bind="tab === 'initial'"></discord-message-preview>
            </div>
        </div>
    </section>
</template>
